## 1. OSPF theory deep review

### 1.1 Core mechanics

- **Protocol basics:**
  
  \[
  \text{Type: IGP (link-state), Protocol number: 89, AD: 110}
  \]
  
  - **Link-state**: each router builds a full topology (LSDB) of its area and runs SPF (Dijkstra) to compute best paths.   
  - **Classless**: supports VLSM/CIDR, no reliance on classful boundaries.   

- **Neighbor formation:**
  - **Hello packets** on multicast 224.0.0.5 (all OSPF routers) and 224.0.0.6 (all DRs/BDRs).   
  - Must match: area ID, subnet, hello/dead timers, authentication, stub flags, and MTU (depending on platform).
  - States: Down ‚Üí Init ‚Üí 2-Way ‚Üí ExStart ‚Üí Exchange ‚Üí Loading ‚Üí Full.

- **SPF and LSDB:**
  - Each area has its own LSDB.
  - SPF runs per area; changes are localized to that area (except for ABR/ASBR roles).   

---

### 1.2 Areas, hierarchy, and ABRs

- **Why areas exist:**
  - **Scale**: smaller LSDB per area ‚Üí faster SPF, less memory, less flooding.   
  - **Stability**: flaps in one area don‚Äôt force SPF in all others.

- **Backbone rules:**
  - Area 0 is mandatory in multi-area designs and must be contiguous.   
  - All non-backbone areas must connect to Area 0 via an ABR or a virtual link.   

- **ABR:**
  - Router with interfaces in Area 0 and at least one non-backbone area.
  - Maintains separate LSDBs per area and performs **inter-area route summarization** and LSA type translation.

---

### 1.3 LSA types (classic set)

- **Type 1 ‚Äì Router LSA:**  
  Intra-area; describes router‚Äôs links and costs within an area.

- **Type 2 ‚Äì Network LSA:**  
  Generated by DR on multi-access segments; represents the multi-access network and attached routers.

- **Type 3 ‚Äì Summary LSA:**  
  Generated by ABRs to advertise inter-area routes into another area.

- **Type 4 ‚Äì ASBR Summary LSA:**  
  Generated by ABRs to tell other areas how to reach an ASBR.

- **Type 5 ‚Äì External LSA:**  
  Generated by ASBRs for external routes (e.g., from BGP, static).

- **Type 7 ‚Äì NSSA External LSA:**  
  Generated inside NSSA; translated to Type 5 by the NSSA ABR.   

(We‚Äôll ignore opaque LSAs for this lab.)

---

### 1.4 Area types (normal, stub, NSSA)

- **Normal area:**
  - All LSA types allowed (1,2,3,4,5).
  - Full flexibility, more LSDB size.

- **Stub area:**
  - Blocks Type 5 (external) LSAs.
  - ABR injects a default route (0.0.0.0/0) into the area.
  - Good for simple branches that don‚Äôt need full external visibility.   

- **Totally stub area (vendor-specific term):**
  - Blocks Type 3, 4, 5; only intra-area LSAs plus a default route from ABR.
  - Minimizes LSDB and routing table.

- **NSSA (Not-So-Stubby Area):**
  - Allows external routes but only as Type 7 LSAs; no Type 5 inside the area.
  - ABR translates Type 7 ‚Üí Type 5 when advertising to other areas.   

- **Totally NSSA:**
  - Like NSSA but also suppresses most Type 3s, relying on a default route plus Type 7s.

---

### 1.5 DR/BDR, network types, and convergence

- **DR/BDR election:**
  - On broadcast and NBMA segments, OSPF elects a DR and BDR.
  - Election based on highest priority, then highest router ID.
  - All routers form full adjacencies with DR/BDR; DROthers stay in 2-Way with each other.

- **Network types:**
  - **Broadcast** (Ethernet): DR/BDR used.
  - **Point-to-point**: no DR/BDR; simpler adjacency.
  - **Point-to-multipoint**: no DR/BDR; each neighbor treated as p2p.

- **Fast convergence knobs (for lab exploration):**
  - Hello/dead timers tuning (e.g., 1/3 seconds on lab links).
  - BFD integration (if supported in your CML image).
  - SPF throttling and LSA pacing (advanced, optional).

---

### 1.6 Virtual links and summarization

- **Virtual links:**
  - Used when a non-backbone area must ‚Äútunnel‚Äù through another area to reach Area 0.
  - Configured between two ABRs that share a common non-backbone area; the virtual link itself is in Area 0.   

- **Summarization:**
  - **Inter-area**: on ABRs, summarizing routes from one area before advertising into another.
  - **External**: on ASBRs, summarizing redistributed prefixes.
  - Reduces LSDB size and routing table entries, improves stability.

---

## 2. CML lab design overview (up to 10 nodes)

We‚Äôll design a single CML project with multiple ‚Äúscenarios‚Äù you can enable/disable by config, not by rewiring the topology every time.

### 2.1 Topology roles

Up to 10 routers:

- **R1, R2:** Backbone core (Area 0).
- **R3, R4:** ABRs to Area 1.
- **R5:** ABR to Area 2 (stub/totally stub variations).
- **R6:** ABR to Area 3 (NSSA variations).
- **R7, R8:** Internal routers in non-backbone areas.
- **R9:** ASBR (redistributes static/BGP into OSPF).
- **R10:** Extra router for virtual link and odd scenarios.

You can trim to fewer nodes by disabling some ABRs/areas.

---

### 2.2 Logical area layout

- **Area 0 (backbone):** R1‚ÄìR2‚ÄìR3‚ÄìR5 (core ring or partial mesh).
- **Area 1 (normal):** R3‚ÄìR4‚ÄìR7.
- **Area 2 (stub/totally stub):** R5‚ÄìR8.
- **Area 3 (NSSA):** R6‚ÄìR9‚ÄìR10 (with R9 as ASBR).
- **Virtual link scenario:** Make R4 only connected to Area 1 and use a virtual link via Area 1 between R1 and R4 to restore backbone continuity.

---

### 2.3 CML wiring suggestion

Use simple /30 or /31 point-to-point links between routers:

- **Backbone links:**
  - R1‚ÄìR2, R2‚ÄìR3, R3‚ÄìR5, optionally R1‚ÄìR5 for redundancy.
- **Area 1:**
  - R3‚ÄìR4, R4‚ÄìR7.
- **Area 2:**
  - R5‚ÄìR8.
- **Area 3:**
  - R6‚ÄìR9, R9‚ÄìR10, R6‚ÄìR2 (to connect Area 3‚Äôs ABR to backbone).
- **Loopbacks:**
  - Each router: Loopback0 as router ID and as ‚Äúcustomer‚Äù prefixes for summarization.

---

## 3. Scenario matrix (what you‚Äôll practice)

Here‚Äôs how to map theory ‚Üí lab exercises:

1. **Single-area OSPF basics (Area 0 only):**
   - Bring up R1‚ÄìR2‚ÄìR3‚ÄìR5 in Area 0.
   - Verify neighbor states, LSDB, SPF, and basic reachability.

2. **Multi-area with normal Area 1:**
   - Add Area 1 on R3‚ÄìR4‚ÄìR7.
   - Observe separate LSDBs, Type 3 LSAs, and ABR behavior.

3. **Stub and totally stub Area 2:**
   - Configure Area 2 as stub, then totally stub.
   - Watch Type 5 suppression and default route injection.

4. **NSSA Area 3 with ASBR:**
   - Configure Area 3 as NSSA.
   - Redistribute static routes on R9; observe Type 7 LSAs and translation to Type 5.

5. **DR/BDR behavior:**
   - Create a broadcast segment (e.g., R1‚ÄìR2‚ÄìR3 on a shared ‚ÄúLAN‚Äù link).
   - Manipulate OSPF priority and router IDs to control DR/BDR.

6. **Virtual link:**
   - Break backbone continuity (e.g., remove R3‚Äôs Area 0 link).
   - Configure virtual link between R1 and R4 through Area 1.

7. **Summarization and convergence tuning:**
   - Summarize loopback prefixes on ABRs.
   - Adjust hello/dead timers and (optionally) BFD to see convergence differences.

---

## 4. Example base configuration templates

I‚Äôll keep these IOS-XE/IOS-like and modular so you can paste into CML and tweak.

### 4.1 Common base (all routers)

```bash
hostname R1
!
no ip domain-lookup
!
interface Loopback0
 ip address 1.1.1.1 255.255.255.255
!
! Example p2p link
interface GigabitEthernet0/0
 description R1-R2
 ip address 10.0.12.1 255.255.255.252
 ip ospf network point-to-point
!
router ospf 1
 router-id 1.1.1.1
 passive-interface Loopback0
!
line con 0
 logging synchronous
!
```

You‚Äôll adjust IPs and router-ids per node.

---

### 4.2 Area assignments (sample snippets)

**R1 (backbone only):**

```bash
router ospf 1
 router-id 1.1.1.1
 passive-interface Loopback0
 network 1.1.1.1 0.0.0.0 area 0
 network 10.0.12.0 0.0.0.3 area 0
 network 10.0.15.0 0.0.0.3 area 0
```

**R3 (ABR between Area 0 and Area 1):**

```bash
router ospf 1
 router-id 3.3.3.3
 passive-interface Loopback0
 network 3.3.3.3 0.0.0.0 area 0
 network 10.0.23.0 0.0.0.3 area 0
 network 10.0.34.0 0.0.0.3 area 1
```

**R5 (ABR to Area 2 stub):**

```bash
router ospf 1
 router-id 5.5.5.5
 passive-interface Loopback0
 network 5.5.5.5 0.0.0.0 area 0
 network 10.0.35.0 0.0.0.3 area 0
 network 10.0.58.0 0.0.0.3 area 2
!
area 2 stub
```

For **totally stub** (Cisco-style):

```bash
router ospf 1
 area 2 stub no-summary
```

(on the ABR; internal routers just `area 2 stub`).

---

### 4.3 NSSA configuration (R6, R9, R10)

**R6 (ABR to Area 3 NSSA):**

```bash
router ospf 1
 router-id 6.6.6.6
 passive-interface Loopback0
 network 6.6.6.6 0.0.0.0 area 0
 network 10.0.26.0 0.0.0.3 area 0
 network 10.0.69.0 0.0.0.3 area 3
!
area 3 nssa
! or for totally NSSA:
! area 3 nssa no-summary
```

**R9 (ASBR inside Area 3):**

```bash
router ospf 1
 router-id 9.9.9.9
 passive-interface Loopback0
 network 9.9.9.9 0.0.0.0 area 3
 network 10.0.69.0 0.0.0.3 area 3
 network 10.0.9.10 0.0.0.3 area 3
!
ip route 172.16.0.0 255.255.0.0 Null0
!
router ospf 1
 redistribute static subnets
```

You‚Äôll see Type 7 LSAs for 172.16.0.0/16 inside Area 3 and Type 5 outside (after ABR translation).

---

### 4.4 DR/BDR tuning

On a shared segment (e.g., R1‚ÄìR2‚ÄìR3 on `Gig0/1`):

```bash
interface GigabitEthernet0/1
 ip address 10.0.100.1 255.255.255.0
 ip ospf 1 area 0
 ip ospf priority 200
```

Set different `ip ospf priority` values on R1/R2/R3 to control DR/BDR.

---

### 4.5 Virtual link example

Assume:

- R1: backbone router.
- R4: only in Area 1.
- R1 and R4 both in Area 1 (10.0.14.0/30).

On **both ABRs** (R1 and R4):

```bash
router ospf 1
 area 1 virtual-link 4.4.4.4   ! on R1, using R4‚Äôs router-id
!
router ospf 1
 area 1 virtual-link 1.1.1.1   ! on R4, using R1‚Äôs router-id
```

This creates a logical Area 0 adjacency over Area 1.

---

## 5. Verification commands per scenario

For each lab, you can build a small checklist‚Äîvery ‚Äúyou‚Äù:

- **Neighbors:**
  - `show ip ospf neighbor`
  - `show ip ospf interface brief`

- **LSDB and LSAs:**
  - `show ip ospf database`
  - `show ip ospf database router`
  - `show ip ospf database summary`
  - `show ip ospf database nssa-external`

- **Routing table:**
  - `show ip route ospf`
  - Check presence/absence of external routes and default routes in stub/NSSA areas.

- **Area and ABR status:**
  - `show ip ospf`
  - `show ip ospf border-routers`

- **Virtual link:**
  - `show ip ospf virtual-links`






# **Multi‚ÄëArea OSPFv2 Practice Lab (CML 2.9.1)**  
A complete, scenario‚Äëdriven OSPFv2 lab built for Cisco Modeling Labs (CML 2.9.1), including:

- Multi‚Äëarea OSPF (Areas 0, 1, 2, 3)  
- Stub & Totally Stub areas  
- NSSA & Totally NSSA  
- ABR behavior  
- ASBR redistribution  
- DR/BDR election on broadcast segment  
- Virtual link operations  
- Full router configs embedded in the YAML (CML 2.9.1 ‚ÄúExtract Configs‚Äù feature)

This repository is designed for hands‚Äëon practice, verification, and deep OSPF theory reinforcement.

---

# **üìÅ Repository Contents**

```
OSPF-Lab/
‚îú‚îÄ‚îÄ OSPF.yaml        # Full CML lab with embedded configs
‚îî‚îÄ‚îÄ README.md        # This documentation
```

---

# **üß© Topology Overview**

The lab contains **10 routers** with the following area design:

| Router | Role | Areas | Notes |
|--------|------|--------|-------|
| R1 | Backbone | 0, 1 (VL endpoint) | DR on broadcast segment |
| R2 | Backbone | 0 | BDR on broadcast segment |
| R3 | ABR | 0, 1 | Connects Area 1 to backbone |
| R4 | Internal | 1 | Virtual‚Äëlink endpoint |
| R5 | ABR | 0, 2 | Stub area ABR |
| R6 | ABR | 0, 3 | NSSA ABR |
| R7 | Internal | 1 | Normal area |
| R8 | Internal | 2 | Stub area |
| R9 | ASBR | 3 | Redistributes static routes |
| R10 | Internal | 3 | NSSA internal |

### **Transit Networks**
- **10.0.100.0/24** ‚Äî Broadcast segment for DR/BDR election (R1, R2, R3)
- **All other links** ‚Äî Point‚Äëto‚Äëpoint /30

---

# **üìò Lab Scenarios**

This lab supports seven structured OSPF scenarios.  
Each scenario can be tested independently or sequentially.

---

## **1. Single‚ÄëArea OSPF (Area 0 Only)**

### **Objective**
- Bring up the backbone (R1‚ÄìR2‚ÄìR3‚ÄìR5‚ÄìR6)
- Validate neighbor formation and LSDB

### **Verification**
```
show ip ospf neighbor
show ip ospf database
show ip route ospf
```

### **Expected**
- All backbone routers FULL adjacency
- Type 1 & Type 2 LSAs only
- Full reachability to all loopbacks

---

## **2. Multi‚ÄëArea OSPF (Areas 0 + 1)**

### **Objective**
- Enable Area 1 on R3‚ÄìR4‚ÄìR7
- Observe ABR behavior

### **Verification**
```
show ip ospf
show ip ospf border-routers
show ip ospf database summary
```

### **Expected**
- R3 becomes ABR
- Type 3 LSAs injected into Area 1
- R4 & R7 see inter‚Äëarea routes (O IA)

---

## **3. Stub Area (Area 2)**

### **Objective**
- Configure Area 2 as stub (R5 ABR + R8 internal)
- Validate default route injection

### **Verification**
```
show ip ospf database external
show ip route
```

### **Expected**
- No Type 5 LSAs inside Area 2
- R8 receives default route `O*IA 0.0.0.0/0`

---

## **4. Totally Stub Area (Area 2)**

### **Objective**
- Convert Area 2 to totally stub
- Observe suppression of Type 3 LSAs

### **Config Notes**
- R5: `area 2 stub no-summary`
- R8: `area 2 stub`

### **Expected**
- Only intra‚Äëarea LSAs + default route

---

## **5. NSSA (Area 3)**

### **Objective**
- Configure Area 3 as NSSA
- Redistribute static routes on R9 (ASBR)

### **Verification**
```
show ip ospf database nssa-external
show ip ospf database external
```

### **Expected**
- Type 7 LSAs inside Area 3
- Type 5 LSAs outside Area 3 (ABR translation)

---

## **6. DR/BDR Election (Broadcast Segment)**

### **Objective**
- Validate DR/BDR election on 10.0.100.0/24

### **Expected Roles**
- **DR = R1** (priority 200)
- **BDR = R2** (priority 1)
- **DROTHER = R3** (priority 100)

### **Verification**
```
show ip ospf neighbor
```

### **Important Behavior**
OSPF **does not preempt**.  
If R3 joins after R2, R3 stays DROTHER even with higher priority.

---

## **7. Virtual Link (Area 1 Transit)**

### **Objective**
- Restore backbone continuity using a virtual link between R1 and R4

### **Requirements**
- R1 and R4 must be neighbors in Area 1  
- Area 1 must NOT be stub/NSSA  
- Router‚ÄëID reachability must exist

### **Verification**
```
show ip ospf virtual-links
show ip ospf database router 1.1.1.1
show ip ospf database router 4.4.4.4
```

### **Expected**
```
Virtual Link OSPF_VL0 to router 4.4.4.4 is up
  State FULL
  Transit area 1
```

---

# **üß™ End‚Äëto‚ÄëEnd Test Plan**

Use this checklist after loading the lab:

### **1. Adjacency Check**
```
show ip ospf neighbor
```
All routers should show FULL adjacency on their respective links.

### **2. LSDB Integrity**
```
show ip ospf database
```
Confirm:
- Type 1/2 in all areas  
- Type 3 from ABRs  
- Type 5 from ASBR (except stub areas)  
- Type 7 in NSSA  

### **3. Routing Table Validation**
```
show ip route ospf
```
Check:
- O routes (intra‚Äëarea)
- O IA routes (inter‚Äëarea)
- O N1/N2 (NSSA external)
- O E1/E2 (external)

### **4. Loopback Reachability**
From R1:
```
ping 2.2.2.2
ping 3.3.3.3
...
ping 10.10.10.10
```

### **5. Virtual Link**
```
show ip ospf virtual-links
```

---

# **üì¶ How to Use This Lab in CML 2.9.1**

### **1. Download the YAML**
```
OSPF.yaml
```

### **2. Import into CML**
- Home ‚Üí Import Lab ‚Üí Select YAML

### **3. Start All Nodes**

### **4. Verify Configs**
All configs are embedded using CML 2.9.1 ‚ÄúExtra Configs‚Äù feature.

---

# **üìö OSPF Theory Covered**

This lab reinforces:

- OSPF neighbor states  
- LSDB structure  
- SPF behavior  
- ABR/ASBR roles  
- LSA Types 1, 2, 3, 4, 5, 7  
- Stub, Totally Stub, NSSA, Totally NSSA  
- DR/BDR election  
- Virtual links  
- Summarization (optional extension)  
- Fast convergence tuning (optional extension)

---

# **üìù Notes**

- All interfaces use /30 point‚Äëto‚Äëpoint except the broadcast segment.  
- Loopbacks serve as router‚ÄëIDs and test prefixes.  
- The lab is intentionally modular so you can enable/disable scenarios without rewiring.

---

# **‚úîÔ∏è Final Thoughts**

This lab is built for **deep OSPF mastery**, not just configuration repetition.  
Every scenario forces you to validate LSDB behavior, routing decisions, and OSPF‚Äôs hierarchical design.

